<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HTML → Markdown Converter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: light dark;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
    }

    .app {
      max-width: 1100px;
      width: 100%;
      margin: 16px;
      padding: 20px;
      border-radius: 16px;
      background: radial-gradient(circle at top left, #1d283a, #020617);
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(148, 163, 184, 0.12);
      box-sizing: border-box;
    }

    .app-header {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .app-title {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: #93c5fd;
    }

    .app-subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .panes {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }

    @media (max-width: 800px) {
      .panes {
        grid-template-columns: 1fr;
      }
    }

    .pane {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .pane label {
      font-size: 0.85rem;
      font-weight: 500;
      color: #d1d5db;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .hint {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    textarea {
      width: 100%;
      min-height: 260px;
      resize: vertical;
      padding: 10px 12px;
      box-sizing: border-box;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.8rem;
      line-height: 1.5;
      outline: none;
    }

    textarea:focus {
      border-color: #60a5fa;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.6);
    }

    .buttons-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }

    .left-buttons,
    .right-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #3b82f6, #22c55e);
      color: white;
      box-shadow: 0 10px 18px rgba(37, 99, 235, 0.45);
      white-space: nowrap;
    }

    button.secondary {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      box-shadow: none;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .status {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .status.ok {
      color: #4ade80;
    }

    .status.error {
      color: #f97373;
    }

    .page-footer {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
    }

    .page-footer a {
      color: #93c5fd;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div class="app-title">HTML → Markdown</div>
      <div class="app-subtitle">Paste HTML on the left, get Markdown on the right.</div>
    </div>

    <div class="panes">
      <div class="pane">
        <label>
          HTML Input
        </label>
        <textarea id="htmlInput" spellcheck="false" placeholder="&lt;h1&gt;Example&lt;/h1&gt;&#10;&lt;p&gt;Some text &lt;strong&gt;here&lt;/strong&gt;.&lt;/p&gt;"></textarea>
      </div>

      <div class="pane">
        <label>
          Markdown Output
        </label>
        <textarea id="markdownOutput" spellcheck="false" readonly></textarea>
      </div>
    </div>

    <div class="buttons-row">
      <div class="left-buttons">
        <button id="convertBtn">Convert</button>
        <button id="clearBtn" class="secondary">Clear</button>
      </div>
      <div class="right-buttons">
        <button id="copyBtn" class="secondary">Copy Markdown</button>
        <button id="downloadBtn" class="secondary">Download .md</button>
        <span id="status" class="status"></span>
      </div>
    </div>
    <footer class="page-footer">
      <a href="https://joldie.github.io/html-tools/" target="_blank" rel="noopener">Home page</a> · <a href="https://github.com/joldie/html-tools/blob/main/html-to-markdown.html" target="_blank" rel="noopener">Source code</a> · Last updated: 2026-02-02
    </footer>
  </div>

  <!-- Turndown via CDN -->
  <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  <script>
    (function () {
      const htmlInput = document.getElementById("htmlInput");
      const markdownOutput = document.getElementById("markdownOutput");
      const convertBtn = document.getElementById("convertBtn");
      const clearBtn = document.getElementById("clearBtn");
      const copyBtn = document.getElementById("copyBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const statusEl = document.getElementById("status");

      let turndown;

      function setStatus(text, type) {
        statusEl.textContent = text || "";
        statusEl.className = "status";
        if (type) statusEl.classList.add(type);
      }

      function initTurndown() {
        if (window.TurndownService) {
          turndown = new TurndownService({
            headingStyle: "atx",
            hr: "---",
            codeBlockStyle: "fenced",
          });

          // Optional: tweak rules for cleaner output
          turndown.addRule("removeEmptySpans", {
            filter: "span",
            replacement: function (content) {
              return content;
            },
          });

          setStatus("Ready.", "ok");
        } else {
          setStatus("Turndown failed to load.", "error");
          convertBtn.disabled = true;
        }
      }

      function convert() {
        if (!turndown) {
          setStatus("Converter not ready.", "error");
          return;
        }
        const html = htmlInput.value || "";
        if (!html.trim()) {
          markdownOutput.value = "";
          setStatus("Nothing to convert.", "");
          return;
        }
        try {
          const md = turndown.turndown(html);
          markdownOutput.value = md;
          setStatus("Converted.", "ok");
        } catch (err) {
          console.error(err);
          setStatus("Conversion error. Check the console.", "error");
        }
      }

      function clearAll() {
        htmlInput.value = "";
        markdownOutput.value = "";
        setStatus("Cleared.", "");
      }

      async function copyMarkdown() {
        const text = markdownOutput.value;
        if (!text.trim()) {
          setStatus("No Markdown to copy.", "");
          return;
        }
        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(text);
          } else {
            // Fallback
            markdownOutput.removeAttribute("readonly");
            markdownOutput.select();
            document.execCommand("copy");
            markdownOutput.setAttribute("readonly", "readonly");
          }
          setStatus("Copied to clipboard.", "ok");
        } catch (err) {
          console.error(err);
          setStatus("Could not copy.", "error");
        }
      }

      function downloadMarkdown() {
        const text = markdownOutput.value;
        if (!text.trim()) {
          setStatus("No Markdown to download.", "");
          return;
        }
        const blob = new Blob([text], { type: "text/markdown;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "converted.md";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        setStatus("Download started.", "ok");
      }

      // Event listeners
      convertBtn.addEventListener("click", convert);
      clearBtn.addEventListener("click", clearAll);
      copyBtn.addEventListener("click", copyMarkdown);
      downloadBtn.addEventListener("click", downloadMarkdown);

      // Convert on Ctrl+Enter / Cmd+Enter in HTML textarea
      htmlInput.addEventListener("keydown", function (e) {
        if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
          e.preventDefault();
          convert();
        }
      });

      // Auto-init once Turndown script is loaded
      if (document.readyState === "complete" || document.readyState === "interactive") {
        setTimeout(initTurndown, 0);
      } else {
        document.addEventListener("DOMContentLoaded", initTurndown);
      }

      // Also try again shortly in case the script loads after DOMContentLoaded
      window.addEventListener("load", function () {
        if (!turndown) initTurndown();
      });
    })();
  </script>
</body>
</html>